# ClarifyChoice 迭代1实施清单

**创建时间**: 2025-12-11 17:20
**目标**: MVP可公网访问（3-4天）
**交付标准**: 用户可通过 http://vultr-ip 访问并使用完整RIPER-5对话流程

---

## 第1天：代码优化（8项任务）✅ 已完成

- [x] 1. 备份当前backend/main.py
- [x] 2. 删除2025就业报告部分（约713-1115行）
- [x] 3. 删除猎聘就业洞察报告部分（约1117-1475行）
- [x] 4. 验证系统提示词约53,500 tokens
- [x] 5. 创建backend/.env文件，添加DEEPSEEK_API_KEY
- [x] 6. 修改backend/main.py从.env读取API Key
- [x] 7. 测试本地运行：python -m uvicorn main:app --reload
- [x] 8. 测试AI响应质量：完成3轮RIPER-5对话

---

## 第2天：Vultr服务器准备（15项任务）【方案A：双站共存】

**特殊说明**：服务器已运行WordPress（xiaowuaibikengpu.com），采用方案A：保留WordPress，新增ClarifyChoice部署

### 现状评估（任务9-11）
- [ ] 9. SSH连接到现有服务器：ssh root@ip-of-clarifychoice-prod
- [ ] 10. 检查WordPress路径和Web服务：ls -la /var/www/ && systemctl status nginx apache2
- [ ] 11. 检查当前Nginx配置：cat /etc/nginx/sites-enabled/xiaowuaibikengpu.com 或 cat /etc/nginx/nginx.conf

### Python环境安装（任务12-14）
- [ ] 12. 更新系统：apt update && apt upgrade -y
- [ ] 13. 安装Python环境（不影响PHP）：apt install -y python3 python3-pip python3-venv git curl
- [ ] 14. 验证Python版本：python3 --version（Ubuntu 24.04应显示3.12.x）

### ClarifyChoice目录创建（任务15-17）
- [ ] 15. 创建应用目录：mkdir -p /var/www/clarifychoice/{backend,frontend}
- [ ] 16. 检查/创建deploy用户：id deploy || (useradd -m -s /bin/bash deploy && usermod -aG sudo deploy)
- [ ] 17. 设置目录权限：chown -R deploy:deploy /var/www/clarifychoice

### Nginx虚拟主机准备（任务18-20）
- [ ] 18. 备份现有Nginx配置：cp -r /etc/nginx/sites-available /etc/nginx/sites-available.backup
- [ ] 19. 验证xiaowuaibikengpu.com配置正常：nginx -t && curl -I http://xiaowuaibikengpu.com
- [ ] 20. 为clarifychoice.com准备配置文件位置（第4天配置）

### 防火墙和DNS准备（任务21-23）
- [ ] 21. 检查防火墙状态：ufw status
- [ ] 22. 确保必要端口开放：ufw allow 22/tcp && ufw allow 80/tcp && ufw allow 443/tcp && ufw enable
- [ ] 23. 【提醒】配置clarifychoice.com的DNS A记录指向服务器IP（在域名注册商处操作）

---

## 第3天：后端部署（8项任务）

- [ ] 24. 上传backend代码到服务器（使用scp或git clone）
- [ ] 25. SSH到服务器：ssh deploy@ip-of-clarifychoice-prod
- [ ] 26. 创建虚拟环境：cd /var/www/clarifychoice/backend && python3 -m venv .venv
- [ ] 27. 安装依赖：source .venv/bin/activate && pip install -r requirements.txt
- [ ] 28. 配置.env文件：nano .env，添加DEEPSEEK_API_KEY和ALLOWED_ORIGINS
- [ ] 29. 测试后端：uvicorn main:app --host 0.0.0.0 --port 8000
- [ ] 30. 验证API可访问：curl http://localhost:8000
- [ ] 31. 配置systemd服务自动启动

---

## 第4天：前端部署与验证（5项任务）

- [ ] 32. 修改frontend/.env.production：VITE_API_URL=https://clarifychoice.com/api
- [ ] 33. 本地构建前端：npm run build
- [ ] 34. 上传dist目录到服务器：scp -r dist/* deploy@ip-of-clarifychoice-prod:/var/www/clarifychoice/frontend/
- [ ] 35. 配置clarifychoice.com的Nginx虚拟主机（静态文件 + API反向代理）
- [ ] 36. 重启Nginx并验证两个域名都可访问：nginx -t && systemctl reload nginx

---

## 上线检查清单

- [ ] 访问 http://xiaowuaibikengpu.com，WordPress网站正常
- [ ] 访问 http://clarifychoice.com，ClarifyChoice前端正常加载
- [ ] 在ClarifyChoice发送消息，AI能正常回复
- [ ] 完成一次完整RIPER-5流程（RESEARCH→INNOVATE→PLAN→EXECUTE→REVIEW）
- [ ] 检查服务器资源使用：free -h, df -h（确认两个站点共存无压力）

---

## 执行记录

### 已完成任务

#### 第1天完成 (2025-12-11 17:20-21:25)
- [x] 1. 备份main.py → main.py.backup-2025-12-11
- [x] 2-3. 删除就业报告（已由用户完成）
- [x] 4. 验证tokens：~33,500（比预期少37%）
- [x] 5. 创建.env和.env.example文件
- [x] 6. 修改main.py导入dotenv并加载.env
- [x] 7-8. 本地测试通过
- [x] **额外优化1**：解决start.sh与.env的冲突
- [x] **额外优化2**：简化start.sh配置流程

#### 第2天重新规划 (2025-12-11 21:30-22:15)
- **发现现有WordPress服务器**：用户已有Vultr服务器运行WordPress（xiaowuaibikengpu.com）
- **服务器规格确认**：2vCPU, 4GB RAM, 80GB SSD, Ubuntu 24.04 LTS, Singapore
- **方案决策变更**：
  - 初始选择：方案B（删除WordPress）
  - **最终决定：方案A（双站共存）** ✅
  - 理由：4GB RAM完全支持WordPress + ClarifyChoice同时运行
  - 域名配置：xiaowuaibikengpu.com（WordPress）+ clarifychoice.com（ClarifyChoice）
- [ ] 9-23. Vultr服务器准备（15项任务 - 双站共存方案）
  - 任务已更新为现状评估 + Python安装 + 虚拟主机准备（适配Ubuntu 24.04）
  - 保留WordPress，新增ClarifyChoice
  - 准备开始执行

### 遇到的问题
（记录问题和解决方案）

### 下一步行动
（记录待办事项）
