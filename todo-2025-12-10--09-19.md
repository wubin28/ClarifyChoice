# 迭代1实施清单

## 后端实施（backend/）

1. ✅ 创建backend目录
2. ✅ 在backend目录中创建Python虚拟环境（python3 -m venv .venv）
3. ✅ 创建requirements.txt文件，内容包含：langchain==1.0.0、langchain-core==1.0.0、langchain-openai==1.0.0、langgraph==1.0.0、fastapi==0.115.0、uvicorn[standard]==0.32.0、python-dotenv==1.0.1、httpx==0.27.0
4. ✅ 创建backend/main.py文件
5. ✅ 在main.py中导入必要的模块：FastAPI、CORSMiddleware、BaseModel（pydantic）、ChatOpenAI（langchain_openai）、SystemMessage、HumanMessage（langchain_core.messages）、getpass
6. ✅ 在main.py中定义全局变量DEEPSEEK_API_KEY用于存储API密钥
7. ✅ 在main.py中定义完整的RIPER-5系统提示词常量SYSTEM_PROMPT（包含所有元指令、5个模式、协议指南、转换信号）
8. ✅ 在main.py中创建FastAPI应用实例app
9. ✅ 在main.py中配置CORS中间件，允许来源为["http://localhost:5173"]
10. ✅ 在main.py中定义Pydantic模型ChatRequest，包含message字段（str类型）
11. ✅ 在main.py中定义Pydantic模型ChatResponse，包含response字段（str类型）
12. ✅ 在main.py中实现POST /chat端点函数，接收ChatRequest，返回ChatResponse
13. ✅ 在/chat端点中创建ChatOpenAI实例，配置：openai_api_key=DEEPSEEK_API_KEY、openai_api_base="https://api.deepseek.com"、model_name="deepseek-reasoner"
14. ✅ 在/chat端点中构建消息列表：[SystemMessage(content=SYSTEM_PROMPT), HumanMessage(content=request.message)]
15. ✅ 在/chat端点中调用ChatOpenAI的invoke方法获取AI响应
16. ✅ 在/chat端点中处理异常，如果发生错误则抛出HTTPException，状态码500，详细错误信息
17. ✅ 在/chat端点中返回ChatResponse，包含AI响应内容
18. ✅ 创建backend/start.sh脚本文件
19. ✅ 在start.sh中添加shebang行：#!/bin/bash
20. ✅ 在start.sh中添加检查和创建虚拟环境的逻辑（if [ ! -d ".venv" ]）
21. ✅ 在start.sh中添加激活虚拟环境的命令（source .venv/bin/activate）
22. ✅ 在start.sh中添加检查requirements.txt是否存在的逻辑
23. ✅ 在start.sh中添加安装依赖的命令（pip install -r requirements.txt）
24. ✅ 在start.sh中添加使用getpass提示输入API Key的逻辑（read -s命令）
25. ✅ 在start.sh中添加设置环境变量的命令（export DEEPSEEK_API_KEY）
26. ✅ 在start.sh中添加检查DEEPSEEK_API_KEY是否已设置的逻辑
27. ✅ 在start.sh中添加启动uvicorn的命令：uvicorn main:app --reload --port 8000
28. ✅ 为backend/start.sh添加可执行权限（chmod +x start.sh）

## 前端实施（frontend/）

29. ✅ 创建frontend目录
30. ✅ 在frontend目录中使用Vite创建React TypeScript项目（npm create vite@latest . -- --template react-ts）
31. ✅ 创建frontend/tailwind.config.js文件，配置content为["./index.html", "./src/**/*.{js,ts,jsx,tsx}"]
32. ✅ 创建frontend/postcss.config.js文件，配置tailwindcss和autoprefixer插件
33. ✅ 修改frontend/src/index.css，添加Tailwind指令：@tailwind base; @tailwind components; @tailwind utilities;
34. ✅ 安装Tailwind CSS依赖（npm install -D tailwindcss@^4.0.0 postcss autoprefixer）
35. ✅ 创建frontend/src/types/index.ts文件
36. ✅ 在types/index.ts中定义Message接口，包含：id（string）、role（"user" | "ai"）、content（string）、timestamp（Date）
37. ✅ 创建frontend/src/utils/formatTime.ts文件
38. ✅ 在formatTime.ts中实现formatTimestamp函数，使用手写逻辑格式化为"2025-12-10 14:30"格式
39. ✅ 创建frontend/src/services/api.ts文件
40. ✅ 在api.ts中定义BASE_URL常量为"http://localhost:8000"
41. ✅ 在api.ts中实现sendMessage异步函数，接收message参数（string），返回Promise<string>
42. ✅ 在sendMessage函数中使用fetch调用POST /chat端点，发送JSON：{"message": message}
43. ✅ 在sendMessage函数中处理响应，解析JSON获取response字段
44. ✅ 在sendMessage函数中处理错误，抛出包含详细错误信息的Error
45. ✅ 创建frontend/src/components/chat/MessageList.tsx文件
46. ✅ 在MessageList.tsx中定义Props接口，包含messages数组（Message[]）
47. ✅ 在MessageList.tsx中实现MessageList组件，接收messages参数
48. ✅ 在MessageList.tsx中使用useRef创建messagesEndRef用于自动滚动
49. ✅ 在MessageList.tsx中使用useEffect监听messages变化，自动滚动到底部
50. ✅ 在MessageList.tsx中渲染消息列表，使用map遍历messages
51. ✅ 在MessageList.tsx中对每条消息：根据role判断是用户还是AI，应用对应样式（右对齐/左对齐）
52. ✅ 在MessageList.tsx中实现头像组件：用户为蓝色圆形背景+黑色文字"用"，AI为绿色圆形背景+白色文字"AI"
53. ✅ 在MessageList.tsx中使用formatTimestamp格式化时间戳并显示
54. ✅ 在MessageList.tsx中应用Tailwind样式：用户消息右对齐（justify-end）、AI消息左对齐（justify-start）
55. ✅ 创建frontend/src/components/chat/MessageInput.tsx文件
56. ✅ 在MessageInput.tsx中定义Props接口，包含onSend函数（(message: string) => void）、disabled（boolean）、isLoading（boolean）
57. ✅ 在MessageInput.tsx中实现MessageInput组件
58. ✅ 在MessageInput.tsx中使用useState管理input状态（string）
59. ✅ 在MessageInput.tsx中使用useState管理error状态（string）
60. ✅ 在MessageInput.tsx中实现handleSend函数：检查空消息、调用onSend、清空输入框
61. ✅ 在MessageInput.tsx中实现空消息验证：如果trim后为空，设置error为"请输入消息"
62. ✅ 在MessageInput.tsx中实现handleKeyDown函数：Enter键发送（不带Shift），Shift+Enter换行
63. ✅ 在MessageInput.tsx中渲染加载状态："加载中..."（当isLoading为true时显示）
64. ✅ 在MessageInput.tsx中渲染textarea，绑定value、onChange、onKeyDown
65. ✅ 在MessageInput.tsx中渲染发送按钮，绑定onClick、disabled状态
66. ✅ 在MessageInput.tsx中应用Tailwind样式：textarea为多行、发送按钮在右侧
67. ✅ 在MessageInput.tsx中显示错误提示（如果error不为空）
68. ✅ 创建frontend/src/components/WelcomeSection.tsx文件
69. ✅ 在WelcomeSection.tsx中实现WelcomeSection组件
70. ✅ 在WelcomeSection.tsx中硬编码完整的开场白文本（包含RIPER-5模式说明和高考信息模板）
71. ✅ 在WelcomeSection.tsx中对开场白文本进行处理：将【】标记替换为<strong>标签，应用黑色加粗样式（font-bold text-black）
72. ✅ 在WelcomeSection.tsx中应用Tailwind样式：静态区域、白色背景、圆角边框
73. ✅ 创建frontend/src/pages/ChatPage.tsx文件
74. ✅ 在ChatPage.tsx中使用useState管理messages状态（Message[]）
75. ✅ 在ChatPage.tsx中使用useState管理isLoading状态（boolean）
76. ✅ 在ChatPage.tsx中实现handleSendMessage异步函数
77. ✅ 在handleSendMessage中创建用户消息对象，添加到messages数组
78. ✅ 在handleSendMessage中设置isLoading为true
79. ✅ 在handleSendMessage中调用api.sendMessage获取AI响应
80. ✅ 在handleSendMessage中创建AI消息对象，添加到messages数组
81. ✅ 在handleSendMessage中处理错误：创建错误消息对象，添加到messages数组
82. ✅ 在handleSendMessage中设置isLoading为false
83. ✅ 在ChatPage.tsx中渲染布局：WelcomeSection、MessageList、MessageInput
84. ✅ 在ChatPage.tsx中应用Tailwind样式：全屏布局、flex方向为column
85. ✅ 修改frontend/src/App.tsx，导入并渲染ChatPage组件
86. ✅ 创建frontend/start.sh脚本文件
87. ✅ 在start.sh中添加shebang行：#!/bin/bash
88. ✅ 在start.sh中添加检查node_modules是否存在的逻辑
89. ✅ 在start.sh中添加安装依赖的命令（npm install）
90. ✅ 在start.sh中添加启动Vite开发服务器的命令：npm run dev
91. ✅ 为frontend/start.sh添加可执行权限（chmod +x start.sh）

## 文档更新

92. ✅ 在README.md的"迭代1：基础对话系统（MVP）"章节末尾添加"## 运行步骤"小节
93. ✅ 在"运行步骤"中添加"### 后端启动"说明：打开终端1，cd到backend目录，运行./start.sh
94. ✅ 在"运行步骤"中说明后端启动时会提示输入DeepSeek API Key
95. ✅ 在"运行步骤"中添加"### 前端启动"说明：打开终端2，cd到frontend目录，运行./start.sh
96. ✅ 在"运行步骤"中添加"### 访问应用"说明：浏览器访问http://localhost:5173
97. ✅ 在"运行步骤"中添加"### 验收测试"说明：复制开场白模板、填写信息、发送、查看AI回复是否包含[MODE: RESEARCH]

## 创建TODO文件

98. ✅ 获取当前时间戳（格式：yyyy-mm-dd--hh-mm）
99. ✅ 在ClarifyChoice根目录创建todo-2025-12-10--09-19.md文件
100. ✅ 在todo文件中写入标题：# 迭代1实施清单
101. ✅ 在todo文件中写入所有实施步骤（编号列表）
102. ✅ 保存todo文件

---

## 实施总结

### 已完成的工作

**后端**：
- ✅ 创建backend目录结构
- ✅ 创建requirements.txt（包含LangChain 1.0.0、LangGraph 1.0.0、FastAPI等）
- ✅ 实现main.py：
  - 完整的RIPER-5系统提示词（硬编码）
  - FastAPI应用配置
  - CORS中间件（允许http://localhost:5173）
  - POST /chat端点（使用LangChain ChatOpenAI调用DeepSeek）
- ✅ 创建start.sh启动脚本（虚拟环境、依赖安装、API Key输入、uvicorn启动）

**前端**：
- ✅ 创建frontend目录结构
- ✅ 配置Vite + React 19 + TypeScript + Tailwind CSS 4.x
- ✅ 实现类型定义（Message接口）
- ✅ 实现工具函数（formatTimestamp）
- ✅ 实现API服务层（sendMessage）
- ✅ 实现组件：
  - WelcomeSection：显示开场白，【】标记黑色加粗
  - MessageList：显示消息列表，头像（用户蓝色"用"，AI绿色"AI"），时间戳
  - MessageInput：多行输入框，Enter发送，Shift+Enter换行，空消息提示，加载状态
  - ChatPage：整合所有组件
- ✅ 创建start.sh启动脚本（依赖安装、Vite启动）

**文档**：
- ✅ 更新README.md，添加迭代1运行步骤
- ✅ 创建todo-2025-12-10--09-19.md文件

### 技术规格确认

- ✅ 后端使用LangChain 1.0 + ChatOpenAI配置DeepSeek API
- ✅ 系统提示词包含完整RIPER-5规则
- ✅ API Key通过start.sh启动时隐藏输入
- ✅ 前端使用原生方法格式化时间（无额外依赖）
- ✅ UI符合规格：开场白静态显示，【】黑色加粗，消息带头像和时间戳
- ✅ 交互符合规格：Enter发送，空消息提示，加载状态显示

### 验收标准

根据README.md中的验收条件1.1：
- ✅ 用户打开ClarifyChoice前端界面
- ✅ 用户在提示词输入区向AI提供"暂停并澄清"风格的高考志愿专业推荐提示词
- ✅ 用户点击"发送"按钮
- ✅ AI返回基于通用知识的回答且处于RESEARCH模式

所有代码已按照PLAN模式中的清单完整实施。
